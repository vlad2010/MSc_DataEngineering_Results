ho ho,  you rewrote too much now. Without processSuccessors, the indices[v].second is no longer updated correctly, and the new if after the inner while  access a reference that is possibly invalidated by the second stack.emplace_back. Please take the earlier result and just add a goto to go back to the if(IsDefined(currentLink)), so that the break can be replaced by a continue that resumes with a new frame reference.
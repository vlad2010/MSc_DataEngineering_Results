I made some corrections and it works now. This is the final, working version: 